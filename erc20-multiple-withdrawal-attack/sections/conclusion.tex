% !TEX root = ../main.tex

\section{Conclusion}

While this paper is a deep dive into a specific issue with ERC20, it also illustrates a number of higher level lessons for blockchain developers. When ERC20 standard was first implemented, it changed how people used Ethereum, giving rise to an ICO craze with its ease of use~\cite{fenu2018ico}. This led to the deployment of thousands of early implementation ERC20 tokens which has resulted in numerous attacks on different implementations. Now we see decentralize exchanges relying on existing ERC20 tokens and the multiple withdrawal attack seems too important to ignore. Fixing existing ERC20 code will help future deployments but cannot fix the already deployed tokens. In addition to deploying secure contracts, we suggest blockchain developers conduct external audits and consider security-by-design practices when dealing with other smart contract implementations. 



%ERC20 token holders should be aware of their approval consequences. If they approve someone to transfer N tokens on behalf of them, the spender can transfer exactly N tokens, even if they reduce the allowance afterwards. This is considered as a legitimate transaction and responsibility of the approver before allowing the spender for transferring any tokens. Multiple withdrawal attack can occur when allowance changes from N to M, that allows a spender to transfer N+M tokens in total by front running of \texttt{approve} method. In this paper, we examined 10 suggested solutions and explained their violation constraints. Since all approaches violated ERC20 specifications or could not address the attack effectively, we introduced two new proposals for securing vulnerable methods---\texttt{approve} and \texttt{transferFrom}. Proposal 1 incorporates CAS pattern for comparing and setting new allowances atomically. It mitigates the attack by adjusting new allowance based on transferred tokens. This allowance adjustment violates one of ERC20 constraints which requires allowance set to new value instead of adjusting it. We concluded that securing \texttt{approve} method is not feasible while adhering this standard constraint. Therefore, we secured \texttt{transferFrom} function instead of \texttt{approve} method in the second proposal. Proposal 2 mitigates the attack effectively and is backward compatible with already deployed smart contracts. Although it consumes more gas compared to standard ERC20 implementations, but it is not vulnerable and could be considered for future secure ERC20 token deployments.